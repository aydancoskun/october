<?php
    $message = $formModel;
?>
<?php if ($message): ?>
    <div style="position:relative">
        <div style="position: absolute; top:0; left:0; bottom:0; right:0"></div>
        <iframe id="<?= $this->getId('messageIframe') ?>" style="width: 100%; height: 500px; padding: 0" frameborder="0"></iframe>
    </div>
    <script type="text/template" id="<?= $this->getId('messageContents') ?>">
        <?= $message->renderTemplate() ?>
    </script>
    <script>
        (function($){
            var messageContents,
                messageFrame = $('#<?= $this->getId('messageIframe') ?>')

            $(document).render(function(){
                var frameContents = messageFrame.contents().find('html')
                messageContents = $('#<?= $this->getId('messageContents') ?>').html()
                frameContents.html(messageContents)
                messageFrame.height(frameContents.height())
            })

            messageFrame.on('print.message', function(){
               var printWindow = window.open('','','left=0,top=0,width=950,height=500,toolbar=0,scrollbars=0,status=0')
               printWindow.document.write(messageContents)
               printWindow.document.close()
               printWindow.focus()
               printWindow.print()
               printWindow.close()
            })
        })(window.jQuery);
    </script>

<?php else: ?>
    <p class="flash-message static error">Invoice template not found</p>
<?php endif ?>