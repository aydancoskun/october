title = "Details"
url = "/account/password-change"
layout = "account"
hidden = "0"
==
<?php
function onStart() {

    \Debugbar::info("Details page onStart()");

//    $user = $this->session->user()-attr;

    $this['invoices']= DB::select(

        "SELECT download_code, transaction_date, credits_purchased, price_paid, transaction_currency, concat((user_id*10),(id*10)) as invoice_number ".

        "FROM ok_payments ".

        "WHERE ".

        "user_id = ". $this->session->user()->attributes['id'] . " " .

        "ORDER BY transaction_date DESC"

    );

}

function onDelete() {

    \Debugbar::info("Details page onDelete()");

    $data = Input::all();

    $rules = ['email' => 'required|email'];

    $msgs = ['required' => 'Please fill in your email','email' => 'Please enter a valid email address'];

    $v = Validator::make($data, $rules, $msgs);



if ($v->fails())

{

    $this['result'] = $v->messages()->first();

}else{

    Mail::queue('email.newsletter', $data, function($message)

    {

        $message->from(post('email'));



        $message->to('simon@skwebproject.com')->subject('New newsletter registration');



    });



        $this['result'] = 'Success!';

    }

}



function onUpdate() {

    \Debugbar::info("Details page onUpdate()");

}
?>
==
{% partial "acc-head" cssfile="oktick.css" %}
{% partial "nav-top" %}
<div class="container">

<h2 class="text-center">Change Password</h2>
<div class="row">
<div class="col-xs-1 col-md-2"></div>
<div class="col-xs-10 col-md-8">
    <form id="update_account_form" data-request="onUpdate">
        <h3>About you</h3>
        <div class="form-group input-group-lg has-feedback">
            <label for="current-password" >Password</label>
            <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>
            <input type="password" class="form-control" id="current-password" placeholder="">
        </div>
        <div class="form-group input-group-lg">
            <label for="new-password-1" >Choose a new password<br><small>Only fill this if you intent to change your password.</small></label>
            <input type="password" class="form-control" id="new-password-1" placeholder="">
        </div>
        <div class="form-group input-group-lg">
            <label for="new-password-2" >Verify the new password</label>
            <input type="password" class="form-control" id="new-password-2" placeholder="">
        </div>
        <div class="text-right">
            <button type="submit" class="btn btn-primary btn-lg">Submit</button>
        </div>
        <!--div class="form-group has-success has-feedback">
            <label class="control-label" for="inputSuccess2">Input with success</label>
            <input type="text" class="form-control" id="inputSuccess2" aria-describedby="inputSuccess2Status">
            <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>
            <span id="inputSuccess2Status" class="sr-only">(success)</span>
        </div-->
    </form>
<script>
function pageInit(){
//    document.write('<script src="/app/ot/assets/jquery.show-password/bootstrap-show-password.min.js"><\/script>');
};
//$('#delete_account_form').request('onDelete', {
//    confirm: 'Are you sure?',
//    redirect: '/dashboard'
//});
function download(download_code)
{
    $.oc.stripeLoadIndicator.show();
    var ifrm = document.getElementById('invoice');
    ifrm.src = 'https://www.oktick.com/account/pdf_invoice/'+download_code;
}
$('#invoice').load(function(){
    $.oc.stripeLoadIndicator.hide();
});
</script>
</div><!--/container -->
{% partial "acc-nav-bottom" %}
{% partial "acc-foot" %}
