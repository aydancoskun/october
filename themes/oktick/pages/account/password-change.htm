title = "Password Change"
url = "/account/password-change"
layout = "main"
is_hidden = "0"
==
<?php
function verifyPost($post_name,$check="int"){
    if( !isset($_POST[$post_name]) ) App::abort(403, 'Forbidden');
    $post_val_raw = post($post_name);
    if($check=="int") $post_val_cast = (int) $post_val_raw;
    if($check=="float") $post_val_cast = (float) $post_val_raw;
    if($check=="string") $post_val_cast = (string) $post_val_raw;
    if( $post_val_raw <> $post_val_cast ) App::abort(403, 'Forbidden');
    return $post_val_cast;
}

function onPasswordChange() {
    $current_password = $this->verifyPost('current_password',"string");
    $new_password_1 = $this->verifyPost('new_password_1',"int");
    $new_password_2 = $this->verifyPost('new_password_2',"int");
    try {
        $user = $this->session->user()->attributes;
        $user_id = $user['id'];
        $current_password = $user['password'];
        $password = Hash::make($current_password);
        return ['status' => 'error','message' => $password,'log' => [  'password' => $password,'current_password' => $current_password,],];
    } catch (Exception $e) {
    
    }
//You may also use the bcrypt helper function:

    $password = bcrypt('secret');
//Verifying A Password Against A Hash

if (Hash::check('secret', $hashedPassword))
{
    // The passwords match...
}
//Checking If A Password Needs To Be Rehashed

if (Hash::needsRehash($hashed))
{
    $hashed = Hash::make('secret');
}

    \Debugbar::info("Password change page onUpdate()");

    return ['status' => 'error','message' => 'Pending product could not be deleted! (err: NP)','log' => [  'err: NP' => $uid,],];
    return ['status' => 'success','message' => 'Pending product deleted!','log' => [  'Pending Product Deleted' => $uid,],];

}
?>
==
{% partial "head" %}
{% partial "nav-top" %}
<div class="container">

<h2 class="text-center">Change Password</h2>
<div class="row">
<div class="col-xs-1 col-md-2"></div>
<div class="col-xs-10 col-md-8">
    <form id="update_account_form" data-request="onUpdate">
        <!--div class="form-group has-success has-feedback"-->
        <div class="form-group has-feedback">
            <label class="control-label" for="current-password">Current Password</label>
            <input type="password" class="form-control" id="current-password" aria-describedby="current-password">
            <span class="glyphicon glyphicon-ok form-control-feedback collapse" aria-hidden="true"></span>
            <span id="current-password-status" class="sr-only">(success)</span>
        </div>
        <div class="form-group has-feedback">
            <label class="control-label" for="new-password-1">Choose a new password</label>
            <input type="password" class="form-control" id="new-password-1" aria-describedby="new-password-1">
            <span class="glyphicon glyphicon-ok form-control-feedback collapse" aria-hidden="true"></span>
            <span id="new-password-1-status" class="sr-only">(success)</span>
        </div>
        <div class="form-group has-feedback">
            <label class="control-label" for="new-password-2">Verify the new password</label>
            <input type="password" class="form-control" id="new-password-2" aria-describedby="new-password-2">
            <span class="glyphicon glyphicon-ok form-control-feedback collapse" aria-hidden="true"></span>
            <span id="new-password-2-status" class="sr-only">(success)</span>
        </div>
        <div class="text-right">
            <button type="submit" class="btn btn-primary btn btn-confirm">Submit</button>
        </div>
    </form>
<script>
$('.btn-confirm').click(function(event){
    event.preventDefault();
    var current_password = $("#current-password").val();
    var new_password_1 = $("#new-password-1").val();
    var new_password_2 = $("#new-password-2").val();
    $.request('onPasswordChange', {
        data: {
            current_password: current_password,
            new_password_1: new_password_1,
            new_password_2: new_password_2,
        }
    })
    .always(function( data, textStatus, errorThrown ) {
        if(data.status=="success"){
            console.log(data.log);
            return
        }
        console.log(data.log);
        return
        console.log(textStatus);
        BootstrapDialog.show({
            title: data.title,
            message: data.message,
            type: BootstrapDialog.TYPE_SUCCESS,
            size: BootstrapDialog.SIZE_SMALL,
            buttons: [{
                label: 'OK',
                //icon: 'glyphicon glyphicon-remove',
                cssClass: 'btn-default',
                action: function(dialog) {dialog.close();},
            }]
        });
    });
});
</script>
</div><!--/container -->
{% partial "nav-bottom" %}
{% partial "foot" %}